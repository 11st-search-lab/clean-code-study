# Clean Code 8장. 경계

시스템을 개발할 때 모든 것을 직접 개발하는 경우는 드물다. 때로는 오픈 소스를 이용하고, 다른 팀이 제공하는 컴포넌트를 사용한다. 외부 코드를 사용할 때 소프트웨어 경계를 깔끔하게 처리하여 우리 코드에 통합하는 방법을 알아보자.

## 외부 코드 사용하기

### 인터페이스 제공자

- 코드가 더 많은 환경에서 작동하도록 적용성을 최대한 넓히려 함

### 인터페이스 사용자

- 자신의 요구에 집중하는 인터페이스를 바람

따라서, 외부 코드를 사용할 때는 경계 인터페이스가 외부에 공개되지 않도록 하는 것이 좋다.

캡슐화 등을 통해 API 인수나 메서드 반환 값 등으로 경계 인터페이스가 직접 노출되지 않도록 한다. 이 방법은 경계 인터페이스가 변경 되었을 때 관련된 코드를 모두 고치지 않아도 되며, 불필요하게 인터페이스를 노출시키지 않을 수 있다는 장점이 있다.

### Bad

```js
const sensors = new HashMap();
const s = sensors.get(sensorId);
```

### Good

```js
class Sensors {
  constructor() {
    this.sensors = new HashMap();
  }
  getById(id) {
    return this.sensors.get(id);
  }
}
```

## 경계 살피고 익히기

외부 코드를 사용하면 적은 시간에 더 많은 기능을 출시하기 쉬워진다. 외부에서 가져온 패키지를 사용하고 싶다면 사용할 코드를 테스트하는 편이 바람직하다. 외부 코드는 익히기 어렵고 통합하기도 어렵기 때문이다.

따라서 곧바로 외부 코드를 호출하는 대신 먼저 간단한 테스트 케이스를 작성해 외부 코드를 익히는 학습 테스트를 생성해야한다. 학습테스트는 사용하려는 목적에 초점을 맞춰 통제된 환경에서 API를 제대로 이해하는 지를 확인하는 방법이다.

## log4j 익히기

로깅 기능을 직접 구현하는 대신 아파치의 log4j 패키지를 사용하려 한다고 가정하자. 라이브러리 문서를 모두 읽어 라이브러리 사용 방식을 익히는 것이 아닌, 학습 테스트를 작성하며 발생하는 에러를 해결하고 그 과정에서 학습할 수 있다. 이 과정에서 얻은 지식을 단위 단위테스트로 정리하고 독자적인 클래스로 분리하면 나머지 클래스에서는 해당 라이브러리의 경계 인터페이스를 몰라도 된다.

1. 화면에 'hello'를 출력하는 테스트 케이스를 작성한다.
2. 테스트 케이스를 돌리니 Appender가 필요하다는 오류 발생 > Appender 생성 후 테스트 케이스 다시 시작
3. Appender에 출력 스트림이 없다는 사실을 발견 > 출력 스트림 추가
4. 'hello'를 출력 성공 (콘솔 로거 초기화 방법을 익힘)
5. 독자적인 로거 클래스로 캡슐화하여 나머지 프로그램이 log4j 경계 인터 페이스를 몰라도 되도록 한다.

## 학습 테스트는 공짜 이상이다.

학습 테스트는 이해도를 높여주는 정확한 실험이다. 패키지의 새 버전이 나온다면 학습 테스트를 돌려 차이가 있는지 확인하며 패키기자 예상대로 작동하는지 검증한다.

코드에 통합한 이후라 하더라도 모든 코드가 호환되리라는 보장은 없다. 패키지 새버전이 나올 때 마다 새로운 위험이 발생할 수 있기 때문이다. 따라서 실제 코드와 동일한 방식으로 인터페이스를 사용하는 테스트 케이스가 필요하다. 이런 경계 테스트가 있다면 패키지의 새 버전으로 이전하기 쉬워진다.

## 아직 존재하지 않는 코드를 사용하기

아는 코드와 모르는 코드를 분리하는 경계도 테스트 해야할 대상이다. API 사용을 캡슐화해 API가 바뀔 때 수정할 코드를 모으는 방법이 있다.

## 깨끗한 경계

이렇듯 경계에 변경이 발생했을 때 이를 반영하기 위해 많은 투자와 재작업을 수행해야 한다. 소프트웨어 설계가 우수하다면 변경에 엄청난 시간과 노력과 재작업이 필요하지 않다. 하지만, 통제하지 못하는 코드를 사용할 때는 너무 많은 투자를 하거나 향후 변경 비용이 지나치게 커지지 않도록 각별히 주의해야 한다.

- 경계에 위치하는 코드는 깔끔히 분리한다.
- 기대치를 정의하는 테스트 케이스도 작성한다.
- 통제가 불가능한 외부 패키지에 의존하는 대신 통제가 가능한 우리 코드에 의존하는 편이 좋다.
- 외부 패키지를 호출하는 코드를 가능한 줄여 경계를 관리하자.
  - 새로운 클래스토 경계를 감싼다.
  - ADAPTER 패턴을 사용해 우리가 원하는 인터페이스를 패키지가 제공하는 인터페이스로 변환한다.

이러한 방식으로 경계를 관리하였을 때 코드 가독성이 높아지며, 경계 인터페이스를 사용하는 일관성도 높아진다. 또한 외부 패키지가 변했을 때 변경할 코드도 줄어든다.
